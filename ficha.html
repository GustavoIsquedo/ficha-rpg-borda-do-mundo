<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha do Eleito</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body { background: #111; color: #fff; font-family: 'Raleway', sans-serif; padding: 20px; }
        .sheet { max-width: 700px; margin: 0 auto; background: #1a1a2e; border: 3px solid #7a00ff; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(122, 0, 255, 0.5); }
        h1 { font-family: 'Cinzel', serif; color: #ffcc00; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; text-transform: uppercase; }
        h2 { color: #c080ff; font-size: 1.2rem; margin-top: 20px; border-bottom: 1px dotted #333; padding-bottom: 5px;}
        p, li { font-size: 0.95rem; line-height: 1.5; }
        .attributes, .defenses { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
        .attributes div, .defenses div { background: #0f0f13; padding: 10px; border-radius: 4px; flex-grow: 1; min-width: 150px; }
        .attributes span, .defenses span { font-weight: bold; color: #ffcc00; font-size: 1.1rem; }
        ul { list-style: none; padding-left: 0; columns: 2; margin-top: 10px; }
        ul li { background: #0f0f13; padding: 5px; margin-bottom: 5px; border-left: 3px solid #ffcc00; }
        #ficha-container { min-height: 300px; text-align: center; }
    </style>
</head>
<body>
    <div class="sheet">
        <div id="ficha-container">
            <h1>Carregando Ficha do Eleito...</h1>
            <p>Se a ficha não carregar, verifique o link ou a conexão com o Firebase.</p>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>

    <script>
        // ==========================================================
        // !! SUBSTITUA PELA SUA CONFIGURAÇÃO REAL DO FIREBASE !!
        // ==========================================================
        const firebaseConfig = {
            apiKey: "SUA_API_KEY", 
            authDomain: "SEU_PROJETO.firebaseapp.com",
            projectId: "SEU-PROJECT-ID",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "SEU_SENDER_ID",
            appId: "SEU_APP_ID"
        };
        // ==========================================================
        
        // Inicializar o Firebase e o Firestore
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        /**
         * Lógica para carregar a ficha exclusiva do URL.
         */
        async function loadCharacterSheet() {
            const urlParams = new URLSearchParams(window.location.search);
            const fichaId = urlParams.get('id'); // Pega o ID da URL (?id=...)
            const container = document.getElementById('ficha-container');

            if (!fichaId) {
                container.innerHTML = "<h1>Ficha Não Encontrada</h1><p>O ID do personagem está faltando no link.</p>";
                return;
            }

            try {
                // Busca a ficha específica usando o ID obtido da URL
                const doc = await db.collection("fichas").doc(fichaId).get();

                if (doc.exists) {
                    const data = doc.data();
                    
                    // Constrói o HTML da lista de perícias
                    const skillListHTML = Object.keys(data.pericias)
                        .filter(skill => data.pericias[skill])
                        .map(skill => `<li>${skill}</li>`)
                        .join('');

                    // Constrói o HTML da ficha
                    container.innerHTML = `
                        <h1>${data.nome}</h1>
                        <p><strong>Classe:</strong> ${data.classe.charAt(0).toUpperCase() + data.classe.slice(1)}</p>
                        <p><strong>PV Base:</strong> ${data.pv_base}</p>
                        <p><strong>Aspiração (Motivação):</strong> ${data.motivacao}</p>

                        <h2>Atributos (Dados D20 Rolados)</h2>
                        <div class="attributes">
                            ${Object.keys(data.atributos).map(key => `<div>${key}: <span>${data.atributos[key]}</span> Dados</div>`).join('')}
                        </div>

                        <h2>Defesas Calculadas (Bônus Total)</h2>
                        <div class="defenses">
                            <div>ESQUIVAR: <span>+${data.defesas.esquivar_base}</span></div>
                            <div>DEFENDER: <span>+${data.defesas.defender_base}</span></div>
                        </div>

                        <h2>Perícias Fixas e Escolhidas</h2>
                        <ul>${skillListHTML}</ul>
                    `;
                } else {
                    container.innerHTML = `<h1>Ficha Não Encontrada</h1><p>Não há registro para o Eleito com ID "${fichaId}" no Limiar.</p>`;
                }
            } catch(e) {
                container.innerHTML = `<h1>Erro de Conexão</h1><p>Não foi possível buscar a ficha. Verifique as regras do Firebase. Detalhe: ${e.message}</p>`;
                console.error(e);
            }
        }

        // Inicia a busca da ficha ao carregar a página
        loadCharacterSheet();
    </script>
</body>
</html>